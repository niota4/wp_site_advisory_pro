jQuery(document).ready(function(e){WSA_Pro_Admin.init(e)});var WSA_Pro_Admin={init:function(e){this.$=e,this.initLicenseManagement(),this.initReportGenerator(),this.initNotifications(),this.initTooltips(),this.initDashboardWidget()},initLicenseManagement:function(){var a=this,e=this.$;e("#wsa-pro-license-form").on("submit",function(e){e.preventDefault(),a.activateLicense()}),e("#wsa-pro-activate-license").on("click",function(e){e.preventDefault(),a.activateLicense()}),e("#wsa-pro-deactivate-license").on("click",function(e){e.preventDefault(),confirm(wsa_pro_admin.deactivate_confirm)&&a.deactivateLicense()}),e("#wsa-pro-check-license").on("click",function(e){e.preventDefault(),a.validateLicense()}),e("#wsa_pro_license_key").length&&e("#wsa_pro_license_key").val()&&setTimeout(function(){a.checkLicenseStatus()},1e3)},activateLicense:function(){var e=this.$,a=e("#wsa-pro-license-form"),t=e("#wsa-pro-activate-license"),i=e(".wsa-license-status"),n=e("#wsa_pro_license_key").val();(n=n&&n.trim())?(t.prop("disabled",!0).text(wsa_pro_admin.activating),a.addClass("wsa-loading"),e.ajax({url:ajaxurl,type:"POST",data:{action:"wsa_pro_activate_license",license_key:n,email:"",nonce:wsa_pro_admin.nonce},success:function(e){e.success?(i.removeClass("inactive expired").addClass("active"),i.find(".wsa-status-icon").removeClass("inactive expired").addClass("active").html("✓"),i.find(".wsa-status-details h3").text(wsa_pro_admin.license_active),i.find(".wsa-status-details p").text(e.data.expires_text||wsa_pro_admin.license_valid),WSA_Pro_Admin.showNotice("success",e.data.message),WSA_Pro_Admin.updateLicenseActions("active"),setTimeout(function(){window.location.reload()},1500)):WSA_Pro_Admin.showNotice("error",e.data.message||e.data)},error:function(e,a,t){WSA_Pro_Admin.showNotice("error",wsa_pro_admin.activation_error+": "+t)},complete:function(){t.prop("disabled",!1).text(wsa_pro_admin.activate_license),a.removeClass("wsa-loading")}})):this.showNotice("error",wsa_pro_admin.license_key_required)},deactivateLicense:function(){var a=this.$,e=a("#wsa-pro-deactivate-license"),t=a(".wsa-license-status");e.prop("disabled",!0).text(wsa_pro_admin.deactivating),a.ajax({url:ajaxurl,type:"POST",data:{action:"wsa_pro_deactivate_license",nonce:wsa_pro_admin.nonce},success:function(e){e.success?(t.removeClass("active expired").addClass("inactive"),t.find(".wsa-status-icon").removeClass("active expired").addClass("inactive").html("✗"),t.find(".wsa-status-details h3").text(wsa_pro_admin.license_inactive),t.find(".wsa-status-details p").text(wsa_pro_admin.enter_license_key),WSA_Pro_Admin.showNotice("success",e.data.message),WSA_Pro_Admin.updateLicenseActions("inactive"),a("#wsa_pro_license_key").val("")):WSA_Pro_Admin.showNotice("error",e.data.message||e.data)},error:function(e,a,t){WSA_Pro_Admin.showNotice("error",wsa_pro_admin.deactivation_error+": "+t)},complete:function(){e.prop("disabled",!1).text(wsa_pro_admin.deactivate_license)}})},validateLicense:function(){var e=this.$,a=e("#wsa-pro-check-license");a.prop("disabled",!0).text(wsa_pro_admin.validating),e.ajax({url:ajaxurl,type:"POST",data:{action:"wsa_pro_validate_license",nonce:wsa_pro_admin.nonce},success:function(e){e.success?(WSA_Pro_Admin.showNotice("success",e.data.message),e.data.status&&WSA_Pro_Admin.updateLicenseStatus(e.data.status,e.data)):WSA_Pro_Admin.showNotice("error",e.data.message||e.data)},error:function(e,a,t){WSA_Pro_Admin.showNotice("error",wsa_pro_admin.validation_error+": "+t)},complete:function(){a.prop("disabled",!1).text(wsa_pro_admin.validate_license)}})},checkLicenseStatus:function(){this.$.ajax({url:ajaxurl,type:"POST",data:{action:"wsa_pro_check_license",nonce:wsa_pro_admin.nonce},success:function(e){e.success&&e.data.status&&WSA_Pro_Admin.updateLicenseStatus(e.data.status,e.data)}})},updateLicenseStatus:function(e,a){var t=(0,this.$)(".wsa-license-status"),i=t.find(".wsa-status-icon"),n=t.find(".wsa-status-details h3"),s=t.find(".wsa-status-details p");switch(t.removeClass("active inactive expired").addClass(e),e){case"active":i.removeClass("inactive expired").addClass("active").html("✓"),n.text(wsa_pro_admin.license_active),s.text(a.expires_text||wsa_pro_admin.license_valid);break;case"expired":i.removeClass("active inactive").addClass("expired").html("⚠"),n.text(wsa_pro_admin.license_expired),s.text(a.expires_text||wsa_pro_admin.license_expired_desc);break;default:i.removeClass("active expired").addClass("inactive").html("✗"),n.text(wsa_pro_admin.license_inactive),s.text(wsa_pro_admin.enter_license_key)}this.updateLicenseActions(e)},updateLicenseActions:function(e){var a=(0,this.$)(".wsa-license-actions");"active"===e?(a.find(".wsa-activate-license").hide(),a.find(".wsa-deactivate-license, .wsa-validate-license").show()):(a.find(".wsa-activate-license").show(),a.find(".wsa-deactivate-license, .wsa-validate-license").hide())},initReportGenerator:function(){var a=this,e=this.$;e(".wsa-generate-report").on("click",function(e){e.preventDefault(),a.generateReport()}),e(".wsa-section-toggle").on("change",function(){a.updateReportPreview()}),e(".wsa-branding-input").on("input change",function(){a.updateBrandingPreview()})},generateReport:function(){var t=this.$,e=t(".wsa-generate-report"),i=t(".wsa-progress"),n=t(".wsa-progress-bar"),a={format:t('input[name="report_format"]:checked').val()||"pdf",sections:[],branding:{logo:t("#report-logo").val(),company_name:t("#company-name").val(),company_url:t("#company-url").val(),primary_color:t("#primary-color").val(),secondary_color:t("#secondary-color").val()},client_info:{name:t("#client-name").val(),email:t("#client-email").val()}},s=(t(".wsa-section-toggle:checked").each(function(){a.sections.push(t(this).val())}),e.prop("disabled",!0).text(wsa_pro_admin.generating_report),i.show(),n.css("width","0%"),0),o=setInterval(function(){90<(s+=15*Math.random())&&(s=90),n.css("width",s+"%")},200);t.ajax({url:ajaxurl,type:"POST",data:{action:"wsa_pro_generate_report",config:JSON.stringify(a),nonce:wsa_pro_admin.nonce},success:function(a){clearInterval(o),n.css("width","100%"),setTimeout(function(){var e;a.success?(WSA_Pro_Admin.showNotice("success",wsa_pro_admin.report_generated),e='<div class="wsa-report-download wsa-fade-in"><h4>'+wsa_pro_admin.report_ready+'</h4><p><a href="'+a.data.file_url+'" target="_blank" class="wsa-btn">'+wsa_pro_admin.download_report+"</a></p></div>",t(".wsa-report-generator").append(e)):a.data&&a.data.license_required?WSA_Pro_Admin.showNotice("error",a.data.message+' <a href="#license">'+wsa_pro_admin.manage_license+"</a>"):WSA_Pro_Admin.showNotice("error",a.data.message||a.data),i.hide()},500)},error:function(e,a,t){clearInterval(o),WSA_Pro_Admin.showNotice("error",wsa_pro_admin.report_error+": "+t),i.hide()},complete:function(){e.prop("disabled",!1).text(wsa_pro_admin.generate_report)}})},updateReportPreview:function(){var e=this.$,a=e(".wsa-section-toggle:checked").length;e(".wsa-section-count").text(a),e("#section-branding").is(":checked")?e(".wsa-branding-options").slideDown():e(".wsa-branding-options").slideUp()},updateBrandingPreview:function(){var e=this.$,a=e("#primary-color").val(),t=e("#secondary-color").val(),a=(e(".wsa-primary-preview").css("background-color",a),e(".wsa-secondary-preview").css("background-color",t),e("#company-name").val());a&&e(".wsa-company-preview").text(a)},initNotifications:function(){var e=this.$;e(document).on("click",".wsa-notice-dismiss",function(){e(this).closest(".wsa-notice").fadeOut()}),setTimeout(function(){e(".wsa-notice.success").fadeOut()},5e3)},showNotice:function(e,a){var t=this.$,i=t('<div class="wsa-notice '+e+' wsa-fade-in"><p>'+a+'</p><button type="button" class="wsa-notice-dismiss">&times;</button></div>');t(".wsa-notice."+e).remove(),t(".wsa-notices").length?t(".wsa-notices").append(i):i.insertAfter("h1").first(),"success"===e&&setTimeout(function(){i.fadeOut()},5e3)},initTooltips:function(){var e=this.$;e(".wsa-tooltip").hover(function(){e(this).find(".wsa-tooltiptext").stop(!0,!0).fadeIn(200)},function(){e(this).find(".wsa-tooltiptext").stop(!0,!0).fadeOut(200)})},initDashboardWidget:function(){var t=this.$;t(".wsa-refresh-widget").on("click",function(e){e.preventDefault();var a=t(this).closest(".wsa-pro-dashboard-widget");a.addClass("wsa-loading"),t.ajax({url:ajaxurl,type:"POST",data:{action:"wsa_pro_refresh_dashboard",nonce:wsa_pro_admin.nonce},success:function(e){e.success&&a.html(e.data.html)},complete:function(){a.removeClass("wsa-loading")}})})},numberFormat:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},debounce:function(i,n,s){var o;return function(){var e=this,a=arguments,t=s&&!o;clearTimeout(o),o=setTimeout(function(){o=null,s||i.apply(e,a)},n),t&&i.apply(e,a)}},getUrlParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}};function updateGracePeriodCountdown(){var e,a=(new Date).getTime(),a=new Date(wsa_pro_admin.grace_period_end).getTime()-a;0<a?(e=Math.floor(a/36e5),a=Math.floor(a%36e5/6e4),$(".wsa-grace-countdown").text(e+"h "+a+"m")):$(".wsa-grace-period-notice").fadeOut()}jQuery(function(a){a("#wsa_pro_license_key").on("input",function(){var e=a(this).val();(-1!==e.indexOf("-")||10<e.length)&&(e=e.replace(/[^a-zA-Z0-9-]/g,"").toUpperCase(),a(this).val(e))}),a.fn.wpColorPicker&&a('.wsa-color-picker input[type="color"]').wpColorPicker({change:function(e,a){WSA_Pro_Admin.updateBrandingPreview()}})}),void 0!==wsa_pro_admin.grace_period_end&&wsa_pro_admin.grace_period_end&&(setInterval(updateGracePeriodCountdown,6e4),updateGracePeriodCountdown());
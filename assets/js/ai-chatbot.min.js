(a=>{class s{constructor(){this.chatWidget=a("#wsa-ai-chatbot"),this.chatToggle=a("#wsa-chatbot-toggle"),this.messagesContainer=a("#wsa-chatbot-messages"),this.messageInput=a("#wsa-chatbot-message"),this.sendButton=a("#wsa-chatbot-send"),this.closeButton=a("#wsa-chatbot-close"),this.clearButton=a("#wsa-chatbot-clear"),this.suggestionsButton=a("#wsa-chatbot-suggestions"),this.suggestionsContainer=a("#wsa-suggested-questions"),this.isOpen=!1,this.isTyping=!1,this.init()}init(){this.bindEvents(),this.loadChatHistory()}bindEvents(){this.chatToggle.on("click",s=>{s.preventDefault(),this.toggleChatbot()}),this.closeButton.on("click",s=>{s.preventDefault(),this.closeChatbot()}),this.sendButton.on("click",s=>{s.preventDefault(),this.sendMessage()}),this.messageInput.on("keydown",s=>{"Enter"!==s.key||s.shiftKey||(s.preventDefault(),this.sendMessage())}),this.clearButton.on("click",s=>{s.preventDefault(),this.clearChat()}),this.suggestionsButton.on("click",s=>{s.preventDefault(),this.toggleSuggestions()}),a(document).on("click",".wsa-suggested-questions .suggestion",s=>{s=a(s.target).text();this.messageInput.val(s),this.sendMessage(),this.hideSuggestions()})}toggleChatbot(){this.isOpen?this.closeChatbot():this.openChatbot()}openChatbot(){this.chatWidget.show(),this.chatToggle.hide(),this.isOpen=!0,this.messageInput.focus(),this.scrollToBottom()}closeChatbot(){this.chatWidget.hide(),this.chatToggle.show(),this.isOpen=!1,this.hideSuggestions()}sendMessage(){var s=this.messageInput.val().trim();s&&!this.isTyping&&(this.addMessage(s,"user"),this.messageInput.val(""),this.showTyping(),a.ajax({url:wsa_admin.ajax_url,type:"POST",data:{action:"wsa_ai_chat",message:s,nonce:wsa_admin.nonce},success:s=>{this.hideTyping(),s.success?(this.addMessage(s.data.response,"assistant"),s.data.tokens_used&&this.addTokenInfo(s.data.tokens_used)):this.addMessage(s.data||"An error occurred. Please try again.","error")},error:(s,t,e)=>{this.hideTyping(),this.addMessage("Failed to send message. Please check your connection and try again.","error"),console.error("Chat error:",e)}}))}addMessage(s,t="assistant"){var e=a("<div>").addClass("wsa-chat-message").addClass(t);"assistant"===t&&(s=this.formatMessage(s)),e.html(s),"user"===t&&this.messagesContainer.find(".wsa-chatbot-welcome").remove(),this.messagesContainer.append(e),this.scrollToBottom()}formatMessage(s){return s=(s=(s=(s=(s=(s=s.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")).replace(/\*(.*?)\*/g,"<em>$1</em>")).replace(/`(.*?)`/g,"<code>$1</code>")).replace(/\n/g,"<br>")).replace(/^\d+\.\s+(.+)$/gm,"<ol><li>$1</li></ol>")).replace(/^-\s+(.+)$/gm,"<ul><li>$1</li></ul>")}showTyping(){this.isTyping=!0,this.sendButton.prop("disabled",!0).text("Sending...");var s=a("<div>").addClass("wsa-chat-typing");s.html('AI is typing... <div class="wsa-typing-dots"><span></span><span></span><span></span></div>'),this.messagesContainer.append(s),this.scrollToBottom()}hideTyping(){this.isTyping=!1,this.sendButton.prop("disabled",!1).text("Send"),this.messagesContainer.find(".wsa-chat-typing").remove()}addTokenInfo(s){var t=a("<div>").addClass("wsa-token-info").css({"font-size":"11px",color:"#666","text-align":"right",margin:"4px 12px 8px","font-style":"italic"});t.text("Tokens used: "+s),this.messagesContainer.append(t)}loadChatHistory(){a.ajax({url:wsa_admin.ajax_url,type:"POST",data:{action:"wsa_get_chat_history",nonce:wsa_admin.nonce},success:s=>{s.success&&0<s.data.length&&(this.messagesContainer.find(".wsa-chatbot-welcome").remove(),s.data.forEach(s=>{this.addMessage(s.message,"user"),this.addMessage(s.response,"assistant")}))}})}clearChat(){confirm("Are you sure you want to clear the chat history?")&&a.ajax({url:wsa_admin.ajax_url,type:"POST",data:{action:"wsa_clear_chat_history",nonce:wsa_admin.nonce},success:s=>{s.success&&this.messagesContainer.html(`
                            <div class="wsa-chatbot-welcome">
                                <p>Hi! I'm your WordPress AI assistant. I can help you with:</p>
                                <ul>
                                    <li>Security optimization</li>
                                    <li>Performance improvements</li>
                                    <li>Plugin conflicts</li>
                                    <li>General WordPress troubleshooting</li>
                                </ul>
                                <p>What would you like to know?</p>
                            </div>
                        `)}})}toggleSuggestions(){this.suggestionsContainer.is(":visible")?this.hideSuggestions():this.showSuggestions()}showSuggestions(){a.ajax({url:wsa_admin.ajax_url,type:"POST",data:{action:"wsa_get_suggested_questions",nonce:wsa_admin.nonce},success:s=>{if(s.success){let t='<p style="margin: 0 0 8px; font-size: 12px; color: #666;">Suggested questions:</p>';s.data.forEach(s=>{t+=`<span class="suggestion">${s}</span>`}),this.suggestionsContainer.html(t).show(),this.suggestionsButton.text("Hide Suggestions")}}})}hideSuggestions(){this.suggestionsContainer.hide(),this.suggestionsButton.text("Show Suggestions")}scrollToBottom(){setTimeout(()=>{this.messagesContainer.scrollTop(this.messagesContainer[0].scrollHeight)},100)}}a(document).ready(function(){a("#wsa-ai-chatbot").length&&new s})})(jQuery);